<Page
    x:Class="GIMI_ModManager.WinUI.Views.CharacterManager.CreateCharacterPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:characterManagerViewModels="using:GIMI_ModManager.WinUI.ViewModels.CharacterManagerViewModels"
    xmlns:controls="using:GIMI_ModManager.WinUI.Views.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:l="using:WinUI3Localizer"
    xmlns:local="using:GIMI_ModManager.WinUI.Views.CharacterManager"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Name="CreateCharacterPageName"
    mc:Ignorable="d">

    <Grid>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>


            <TextBlock Margin="0,8,0,8" Text="Create Character" l:Uids.Uid="/CharacterManager/CreatePageTitle" />

            <ScrollViewer Grid.Row="1" Grid.Column="0">

                <StackPanel Spacing="8">

                    <StackPanel>
                        <TextBlock Text="Character Image" l:Uids.Uid="/CharacterManager/CharacterImageLabel" />
                        <local:InputWrapper InputField="{x:Bind ViewModel.Form.Image}">
                            <local:InputWrapper.Input>
                                <controls:CustomImage
                                    Width="300"
                                    Height="200"
                                    HorizontalAlignment="Left"
                                    ButtonHorizontalAlignment="Left"
                                    ClearButtonCommand="{x:Bind ViewModel.ClearImageCommand}"
                                    CopyButtonVisibility="Collapsed"
                                    EditButtonCommand="{x:Bind ViewModel.SelectImageCommand}"
                                    ImageUri="{x:Bind ViewModel.Form.Image.Value, Mode=TwoWay}"
                                    IsContextMenuEnabled="True"
                                    PasteButtonCommand="{x:Bind ViewModel.PasteImageCommand}" />
                            </local:InputWrapper.Input>
                        </local:InputWrapper>

                    </StackPanel>



                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.InternalName}">
                        <local:InputWrapper.Input>
                            <TextBox
                                MinWidth="200"
                                Header="Internal Name (Required)"
                                PlaceholderText="{x:Bind ViewModel.Form.InternalName.PlaceHolderText, Mode=OneWay}"
                                Text="{x:Bind ViewModel.Form.InternalName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                l:Uids.Uid="/CharacterManager/InternalNameInput" />
                        </local:InputWrapper.Input>

                        <local:InputWrapper.HelpInfo>
                            <TextBlock IsTextSelectionEnabled="True" TextWrapping="WrapWholeWords"
                                       Text="The internal name is used by JASM to identify the Character / Moddable Object. It is also used as the name of the folder for mods. Must be unique. Changing this after creation means JASM will identify it as a new character."
                                       l:Uids.Uid="/CharacterManager/InternalNameHelp" />
                        </local:InputWrapper.HelpInfo>
                    </local:InputWrapper>


                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.DisplayName}">
                        <local:InputWrapper.Input>
                            <TextBox
                                MinWidth="200"
                                Header="Display Name"
                                PlaceholderText="{x:Bind ViewModel.Form.DisplayName.PlaceHolderText, Mode=OneWay}"
                                Text="{x:Bind ViewModel.Form.DisplayName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                l:Uids.Uid="/CharacterManager/DisplayNameInput" />
                        </local:InputWrapper.Input>
                    </local:InputWrapper>

                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.ModFilesName}">
                        <local:InputWrapper.Input>
                            <TextBox
                                MinWidth="200"
                                Header="Mod Files Name"
                                PlaceholderText="{x:Bind ViewModel.Form.ModFilesName.PlaceHolderText, Mode=OneWay}"
                                Text="{x:Bind ViewModel.Form.ModFilesName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                l:Uids.Uid="/CharacterManager/ModFilesNameInput" />
                        </local:InputWrapper.Input>

                        <local:InputWrapper.HelpInfo>
                            <TextBlock IsTextSelectionEnabled="True" TextWrapping="WrapWholeWords"
                                       Text="In some cases JASM can try to determine what character a mod is for. When doing so it uses the 'Mod Files Name' text to try and find mod files with that name. For example if the 'Mod Files Name' is 'paimon' it will match files like 'PaimonHeadLightMap.dds'. Leave blank if you don't want JASM to try and match mod files."
                                       l:Uids.Uid="/CharacterManager/ModFilesNameHelp" />
                        </local:InputWrapper.HelpInfo>
                    </local:InputWrapper>


                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.ReleaseDate}">
                        <local:InputWrapper.Input>
                            <CalendarDatePicker Date="{x:Bind ViewModel.Form.ReleaseDate.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Header="Release Date" l:Uids.Uid="/CharacterManager/ReleaseDateInput" />
                        </local:InputWrapper.Input>
                    </local:InputWrapper>

                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.Rarity}">
                        <local:InputWrapper.Input>
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <Slider
                                    Width="200"
                                    AutomationProperties.Name="Slider with ticks"
                                    Header="Rarity"
                                    Maximum="6"
                                    Minimum="0"
                                    SnapsTo="Ticks"
                                    TickFrequency="1"
                                    TickPlacement="Outside"
                                    Value="{x:Bind ViewModel.Form.Rarity.Value, Mode=TwoWay}"
                                    l:Uids.Uid="/CharacterManager/RaritySlider" />
                                <TextBlock VerticalAlignment="Center" Text="{x:Bind ViewModel.Form.Rarity.Value, Mode=OneWay}" />
                            </StackPanel>
                        </local:InputWrapper.Input>
                    </local:InputWrapper>

                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.Element}">
                        <local:InputWrapper.Input>
                            <ComboBox
                                Header="Element"
                                ItemsSource="{x:Bind ViewModel.Elements}"
                                SelectedItem="{x:Bind ViewModel.SelectedElement, Mode=TwoWay}"
                                l:Uids.Uid="/CharacterManager/ElementComboBox" />
                        </local:InputWrapper.Input>
                    </local:InputWrapper>

                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.IsMultiMod}">
                        <local:InputWrapper.Input>
                            <CheckBox Content="Allow Multiple Mods Enabled" IsChecked="{x:Bind ViewModel.Form.IsMultiMod.Value, Mode=TwoWay}" l:Uids.Uid="/CharacterManager/IsMultiModCheckBox" />
                        </local:InputWrapper.Input>

                        <local:InputWrapper.HelpInfo>
                            <TextBlock IsTextSelectionEnabled="True" TextWrapping="WrapWholeWords"
                                       Text="If checked, JASM will not show a warning when multiple mods are enabled for this moddable object."
                                       l:Uids.Uid="/CharacterManager/IsMultiModHelp" />
                        </local:InputWrapper.HelpInfo>
                    </local:InputWrapper>




                </StackPanel>
            </ScrollViewer>

            <Grid
                Grid.Row="1"
                Grid.Column="1"
                Margin="8,0"
                Padding="4"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                CornerRadius="8">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock FontSize="16" Text="Search Keywords" l:Uids.Uid="/CharacterManager/SearchKeywordsLabel" />
                    <TextBox
                        Grid.Column="1"
                        PlaceholderText="Keyword..."
                        Text="{x:Bind ViewModel.NewKeyNameInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        l:Uids.Uid="/CharacterManager/KeywordInput" />
                    <Button
                        Grid.Column="2"
                        Margin="0,0,20,0"
                        HorizontalAlignment="Right"
                        Command="{x:Bind ViewModel.AddNewKeyCommand}"
                        Content="Add Keyword"
                        l:Uids.Uid="/CharacterManager/AddKeywordButton" />

                    <Button
                        Grid.Column="3"
                        VerticalAlignment="Bottom"
                        Content="?">
                        <Button.Flyout>
                            <Flyout>
                                <Grid MaxWidth="200">
                                    <TextBlock
                                        IsTextSelectionEnabled="True"
                                        TextWrapping="WrapWholeWords"
                                        Text="JASM uses keywords to help with the search functionality. Some characters might have multiple names, so you can add extra names or search terms as keywords."
                                        l:Uids.Uid="/CharacterManager/KeywordHelpText" />
                                </Grid>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                </Grid>


                <StackPanel Grid.Row="1">
                    <ListView ItemsSource="{x:Bind ViewModel.Form.Keys.Items, Mode=OneWay}" SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Grid
                                    Padding="4"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    ColumnSpacing="32"
                                    CornerRadius="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontSize="16"
                                        IsTextSelectionEnabled="True"
                                        Text="{Binding Mode=OneWay}" />
                                    <Button
                                        Grid.Column="1"
                                        HorizontalAlignment="Right"
                                        Command="{Binding ElementName=CreateCharacterPageName, Path=ViewModel.RemoveKeyCommand, Mode=OneWay}"
                                        CommandParameter="{Binding Mode=OneTime}"
                                        Content="Remove"
                                        l:Uids.Uid="/CharacterManager/RemoveKeywordButton" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    <local:InputWrapper InputField="{x:Bind ViewModel.Form.Keys}" />
                </StackPanel>


            </Grid>


            <Grid
                Grid.Row="2"
                Grid.Column="1"
                Margin="0,16,0,0">
                <StackPanel
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    Spacing="40">
                    <Button Command="{x:Bind ViewModel.ExportCharacterCommand}" Content="Export Character JSON" l:Uids.Uid="/CharacterManager/ExportJsonButton" />
                    <Button Command="{x:Bind ViewModel.OpenCustomCharacterJsonFileCommand}" Content="Open Custom Character JSON File" l:Uids.Uid="/CharacterManager/OpenJsonFileButton" />
                    <Button Background="{ThemeResource AccentFillColorDefaultBrush}" Command="{x:Bind ViewModel.SaveCharacterCommand}" Content="Create Character" l:Uids.Uid="/CharacterManager/SaveCharacterButton" />
                </StackPanel>
            </Grid>


        </Grid>

    </Grid>
</Page>